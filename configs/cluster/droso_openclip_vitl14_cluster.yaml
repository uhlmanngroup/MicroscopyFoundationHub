# Environment: cluster (UZH Science) - Drosophila-only segmentation run
# OpenCLIP ViT-L-14 config.

# ---- I/O ----
train_img_dir: "/home/cfuste/data/datasets/Droso/Train_In"
train_mask_dir: "/home/cfuste/data/datasets/Droso/Train_Out"
test_img_dir:    "/home/cfuste/data/datasets/Droso/Test_In"
test_mask_dir:   "/home/cfuste/data/datasets/Droso/Test_Out"

# results + experiment naming
experiment_id: "2026-01-15_droso_openclip_vitl14_lora-r16_seg"
results_root: "/home/cfuste/data/DINO-LoRA/openclip/"
task_type: "seg"

# dataset pairing (drosophila images share numeric stems with their masks)
dataset:
  type: droso
  params:
    recursive: true

# ---- model / backbone ----
backbone:
  name: openclip
  model: "ViT-L-14"
  pretrained: "laion2b_s32b_b82k"
  weights: ""
  preprocess:
    preset: em
dino_size: "ViT-L-14"
img_size:
  mode: longest_edge
  target: 1022
  patch_multiple: 14
  rounding: floor
num_classes: 2

# ---- LoRA ----
use_lora: true
lora_rank: 16
lora_alpha: 32
lora:
  enabled: true
  target_policy: vit_attention_only
  layer_selection: all
  exclude: [head, decoder, seg_head]
  compatibility_mode: true

# ---- training ----
batch_size: 4
epochs: 1000
patience: 20
lr: 0.00005
weight_decay: 0.0001
num_workers: 4
device: auto
amp: false

# ---- loss (Dice) ----
loss: dice
class_weights: [1.0, 15.0]
tversky_alpha: 0.7
tversky_beta: 0.3
tversky_eps: 1.0e-6
tversky_weight: 0.6

# ---- training safety ----
clip_grad_norm: 1.0

# ---- export / viz ----
binarize: true
binarize_threshold: 128
